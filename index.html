<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lupa Editions ‚Äì Presupuesto Profesional</title>

  <!-- intl-tel-input CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/css/intlTelInput.min.css" />
  <!-- intl-tel-input JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/js/intlTelInput.min.js"></script>

  <!-- html2pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --color-primary: #111;
      --color-secondary: #555;
      --color-bg: #f9f9f9;
      --color-accent: #e0e0e0;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0; padding: 0;
      background-color: var(--color-bg);
      color: var(--color-primary);
    }
    .container {
      max-width: 860px;
      margin: 40px auto;
      padding: 30px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
    }
    .logo {
      text-align: center;
      margin-bottom: 24px;
    }
    .logo img {
      max-width: 200px;
      border: 0;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    p.slogan {
      text-align: center;
      font-style: italic;
      color: var(--color-secondary);
      margin: 0 0 18px 0;
    }
    .description {
      text-align: center;
      font-size: 16px;
      color: #444;
      margin-bottom: 24px;
      line-height: 1.6;
    }
    form label {
      font-weight: 600;
      display: block;
      margin-top: 18px;
    }
    form input, form select, form textarea {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 12px;
      box-sizing: border-box;
      font-size: 15px;
    }
    .field-description {
      font-size: 13px;
      color: var(--color-secondary);
      margin-top: 4px;
      margin-bottom: 12px;
      font-style: italic;
    }
    button {
      margin-top: 28px;
      background-color: var(--color-primary);
      color: #fff;
      border: none;
      padding: 14px 26px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 17px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #000;
    }
    .footer-message {
      margin-top: 48px;
      font-size: 13px;
      color: #777;
      text-align: center;
      line-height: 1.5;
    }
    #whatsapp-link {
      font-size: 16px;
      text-decoration: none;
      background: #25d366;
      color: white;
      padding: 10px 18px;
      border-radius: 12px;
      display: none;
      margin-top: 16px;
    }
    #preview-container {
      margin-top: 24px;
      padding: 20px;
      border: 1px dashed #ccc;
      border-radius: 12px;
      background-color: #fafafa;
    }
    #progress-bar {
      display: none;
      margin-top: 20px;
      width: 100%;
      background-color: #eee;
      border-radius: 10px;
      overflow: hidden;
    }
    #progress-bar div {
      height: 16px;
      background-color: #4caf50;
      width: 0%;
      transition: width 0.4s ease;
    }
    #success-message {
      display: none;
      margin-top: 20px;
      background-color: #e6ffed;
      color: #207844;
      border: 1px solid #b2e2c1;
      padding: 12px;
      border-radius: 12px;
      text-align: center;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container" id="pdf-content">
    <div class="logo">
      <a href='https://postimg.cc/t7Tfd4Wy' target='_blank'>
        <img src='https://i.postimg.cc/t7Tfd4Wy/LOGO-FINAL.jpg' alt='LOGO-FINAL'/>
      </a>
    </div>

    <h1>Lupa Editions</h1>
    <p class="slogan">El detalle no adorna, comunica</p>
    <p class="description">
      Completa este formulario para recibir tu presupuesto personalizado de edici√≥n de video.<br>
      Te responderemos en 24 a 48 horas.<br>
      <strong>Juntos mejoramos tu video para que comunique con impacto y conecte con tu audiencia.</strong>
    </p>

    <form id="budget-form">
      <label for="nombre">Nombre completo:</label>
      <input type="text" id="nombre" name="nombre" placeholder="Tu nombre completo" required />
      <div class="field-description">Indica tu nombre y apellido</div>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" placeholder="correo@ejemplo.com" required />
      <div class="field-description">Email para contacto y env√≠o del presupuesto</div>

      <label for="telefono">Tel√©fono / WhatsApp</label>
      <input type="tel" id="telefono" name="telefono" required />
      <div class="field-description">Selecciona tu pa√≠s y escribe tu n√∫mero sin c√≥digo de pa√≠s</div>

      <label for="descripcion">Descripci√≥n del proyecto:</label>
      <textarea id="descripcion" name="descripcion" rows="3" placeholder="Describe brevemente tu proyecto de video" required></textarea>

      <label for="preferencias">Preferencias o detalles especiales:</label>
      <textarea id="preferencias" name="preferencias" rows="2" placeholder="Colores, estilo, m√∫sica, etc."></textarea>

      <label for="tipo_cliente">Tipo de cliente:</label>
      <select id="tipo_cliente" name="tipo_cliente" required>
        <option value="">-- Selecciona --</option>
        <option value="puntual">Puntual</option>
        <option value="continuo">Continuo</option>
      </select>

      <label for="tipo_edicion">Tipo de edici√≥n deseada:</label>
      <select id="tipo_edicion" name="tipo_edicion" required>
        <option value="">-- Selecciona --</option>
        <option value="basica">Edici√≥n b√°sica (cortes y ajustes simples)</option>
        <option value="avanzada">Edici√≥n avanzada (animaciones, correcci√≥n de color)</option>
        <option value="subtitulos">Edici√≥n con subt√≠tulos</option>
        <option value="otros">Otros (describir en preferencias)</option>
      </select>

      <label for="entrega">Plazo estimado de entrega:</label>
      <input type="text" id="entrega" name="entrega" placeholder="Ej: 7 d√≠as, 2 semanas" />

      <label for="idioma">Idioma:</label>
      <select id="idioma" name="idioma">
        <option value="es">Espa√±ol</option>
        <option value="en">Ingl√©s</option>
      </select>

      <div class="footer-message" id="legal-text"></div>

      <button type="submit">üìÑ Generar PDF</button>
    </form>

    <div id="preview-container">
      <strong>üìé Vista previa del mensaje para WhatsApp:</strong>
      <p id="preview-text"></p>
    </div>

    <a id="whatsapp-link" href="#" target="_blank"></a>

    <div id="progress-bar"><div></div></div>
    <div id="success-message">‚úÖ ¬°El PDF fue generado exitosamente!</div>

    <div style="text-align:center; margin-top: 16px;">
      <button type="button" onclick="limpiarFormulario()">üßπ Limpiar formulario</button>
    </div>
  </div>

<script>
  const form = document.getElementById('budget-form');
  const legalText = document.getElementById('legal-text');
  const whatsappLink = document.getElementById('whatsapp-link');
  const previewText = document.getElementById('preview-text');
  const progressBar = document.getElementById('progress-bar');
  const progressInner = progressBar.querySelector('div');
  const successMessage = document.getElementById('success-message');
  let lang = 'es';

  const texts = {
    es: `üì© Recibir√°s respuesta dentro de las pr√≥ximas 24 a 48 hs.<br>
         üîí Tus datos est√°n protegidos y no ser√°n compartidos.<br>
         ‚öñÔ∏è Este presupuesto tiene validez de 7 d√≠as. El uso comercial est√° sujeto al acuerdo final.<br>
         ¬© Lupa Editions. Todos los derechos reservados.`,
    en: `üì© You will receive a response within 24 to 48 hours.<br>
         üîí Your data is protected and will not be shared.<br>
         ‚öñÔ∏è This quote is valid for 7 days. Commercial use is subject to final agreement.<br>
         ¬© Lupa Editions. All rights reserved.`
  };

  function toggleLanguage() {
    lang = lang === 'es' ? 'en' : 'es';
    legalText.innerHTML = texts[lang];
  }

  toggleLanguage();

  const fields = ['nombre', 'email', 'telefono', 'descripcion', 'preferencias', 'tipo_cliente', 'tipo_edicion', 'entrega', 'idioma'];
  fields.forEach(id => {
    const el = document.getElementById(id);
    if(el) {
      el.value = localStorage.getItem(id) || '';
      el.addEventListener('input', () => localStorage.setItem(id, el.value));
    }
  });

  // Inicializar intl-tel-input con detecci√≥n autom√°tica de pa√≠s
  const phoneInputField = document.querySelector("#telefono");
  const iti = window.intlTelInput(phoneInputField, {
    initialCountry: "auto",
    geoIpLookup: callback => {
      fetch("https://ipapi.co/json")
        .then(res => res.json())
        .then(data => callback(data.country_code))
        .catch(() => callback("ar")); // fallback Argentina
    },
    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/js/utils.js"
  });

  form.addEventListener('submit', function (e) {
    e.preventDefault();
    progressBar.style.display = 'block';
    progressInner.style.width = '30%';
    successMessage.style.display = 'none';

    const element = document.getElementById('pdf-content');
    const nombre = document.getElementById('nombre').value;

    // Validar n√∫mero con intl-tel-input
    if(!iti.isValidNumber()) {
      alert('Por favor ingresa un n√∫mero de tel√©fono v√°lido.');
      progressBar.style.display = 'none';
      progressInner.style.width = '0%';
      return;
    }

    // Obtener n√∫mero completo con c√≥digo pa√≠s para WhatsApp (sin +)
    const telefonoCompleto = iti.getNumber().replace(/\D/g, '');
    const msg = encodeURIComponent(`Hola! Soy ${nombre} y ya gener√© el PDF del presupuesto desde el formulario de Lupa Editions. ¬°Gracias! üôå`);
    const link = `https://wa.me/${telefonoCompleto}?text=${msg}`;

    previewText.innerText = decodeURIComponent(msg);

    html2pdf().set({
      margin: 0.5,
      filename: 'Presupuesto_Lupa_Editions.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    }).from(element).save().then(() => {
      progressInner.style.width = '100%';
      setTimeout(() => {
        progressBar.style.display = 'none';
        progressInner.style.width = '0%';
        successMessage.style.display = 'block';
      }, 800);
      whatsappLink.href = link;
      whatsappLink.style.display = 'inline-block';
      whatsappLink.innerText = 'üì≤ Enviar PDF por WhatsApp';
    });
  });

  function limpiarFormulario() {
    fields.forEach(id => {
      const el = document.getElementById(id);
      if(el) {
        el.value = '';
        localStorage.removeItem(id);
      }
    });
    whatsappLink.style.display = 'none';
    previewText.innerText = '';
    successMessage.style.display = 'none';
    progressBar.style.display = 'none';
    progressInner.style.width = '0%';
    iti.setNumber(''); // Limpiar input intl-tel-input
  }
</script>
</body>
</html>

